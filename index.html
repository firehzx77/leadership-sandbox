<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>æ–°ä¸–ä»£æƒ…å¢ƒé¢†å¯¼åŠ› Â· 9å¤§æ¡ˆä¾‹è¯æ®AIè£åˆ¤ï¼ˆç«èµ›ç‰ˆ Â· DeepSeekï¼‰</title>
  <style>
    :root {
      --primary: #0052d4;
      --primary-light: #4286f4;
      --primary-dark: #002A7F;
      --accent: #ffb300;
      --accent-soft: #ffe082;
      --danger: #e53935;
      --bg: #060b1a;
      --card-bg: #ffffff;
      --border: #e0e0e0;
      --text-main: #222;
      --text-light: #666;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 20px 16px 40px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, "å¾®è½¯é›…é»‘", sans-serif;
      background:
        radial-gradient(circle at 0 0, rgba(0, 82, 212, 0.25), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(66, 134, 244, 0.25), transparent 55%),
        radial-gradient(circle at 50% 100%, rgba(255, 179, 0, 0.18), transparent 55%),
        linear-gradient(160deg, #060b1a 0%, #0b1228 45%, #060b1a 100%);
      color: var(--text-main);
    }

    h1, h2, h3, h4 { margin: 0; font-weight: 600; }
    a { color: inherit; text-decoration: none; }

    /* é¡¶éƒ¨æ ï¼šæ ‡é¢˜ */
    .top-bar {
      max-width: 1160px;
      margin: 0 auto 16px;
      padding: 14px 16px 16px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(0,82,212,0.95), rgba(66,134,244,0.9));
      color: #fff;
      box-shadow: 0 10px 25px rgba(0,0,0,0.25);
      position: sticky;
      top: 10px;
      z-index: 50;
    }

    .top-bar-main {
      display: flex;
      justify-content: space-between;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(0,0,0,0.2);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .title-badge span.dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #4caf50;
      box-shadow: 0 0 0 4px rgba(76,175,80,0.35);
    }

    .top-bar h1 { font-size: 20px; }
    .top-subtitle { font-size: 12px; opacity: 0.9; }

    .top-bar-right {
      min-width: 260px;
      max-width: 380px;
      flex: 1;
      font-size: 11px;
      line-height: 1.5;
    }

    .top-tip code {
      font-size: 11px;
      padding: 1px 4px;
      border-radius: 4px;
      background: rgba(0,0,0,0.25);
    }

    /* ä¸»å®¹å™¨ */
    .main-shell {
      max-width: 1160px;
      margin: 14px auto 0;
      padding: 14px 16px 20px;
      border-radius: 18px;
      background: rgba(255,255,255,0.97);
      box-shadow: 0 18px 40px rgba(0,0,0,0.32);
    }

    /* é¡¶éƒ¨ Scoreboard */
    .scoreboard {
      margin-bottom: 12px;
      padding: 8px 10px 10px;
      border-radius: 14px;
      background: linear-gradient(120deg, rgba(255,243,224,0.98), rgba(255,255,255,0.98));
      border: 1px solid #ffe0b2;
      box-shadow: 0 4px 10px rgba(255,167,38,0.12);
    }

    .scoreboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }

    .scoreboard-title-block {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .scoreboard-badge {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      background: #ffecb3;
      color: #e65100;
      letter-spacing: 0.08em;
    }

    .scoreboard h2 {
      font-size: 15px;
      color: #bf360c;
    }

    .scoreboard-active-case {
      font-size: 12px;
      color: #6d4c41;
    }

    .scoreboard-body {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 220px;
      overflow-y: auto;
      padding-right: 2px;
    }

    .scoreboard-empty {
      font-size: 12px;
      color: var(--text-light);
    }

    .scoreboard-row {
      border-top: 1px dashed #ffe0b2;
      padding-top: 4px;
    }

    .scoreboard-row-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      margin-bottom: 2px;
      flex-wrap: wrap;
    }

    .scoreboard-group-name {
      font-weight: 600;
      color: #5d4037;
    }

    .scoreboard-group-net {
      font-size: 11px;
      padding: 1px 8px;
      border-radius: 999px;
      background: #fff3e0;
      border: 1px solid #ffe0b2;
      color: #e65100;
    }

    .scoreboard-meters {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 4px 10px;
    }

    @media (max-width: 720px) {
      .scoreboard-meters {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .scoreboard-meter {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
    }

    .scoreboard-meter span.meter-label {
      width: 64px;
      color: #8d6e63;
    }

    .scoreboard-meter input[type="range"] {
      flex: 1;
      accent-color: #fb8c00;
    }

    .scoreboard-meter span.meter-value {
      width: 52px;
      text-align: right;
      font-weight: 600;
      color: #e65100;
    }

    .scoreboard-meter span.meter-value.neg {
      color: var(--danger);
    }

    /* æ ‡ç­¾æ  */
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      border-bottom: 1px solid #d7e3ff;
      padding-bottom: 8px;
      margin-bottom: 10px;
    }

    .tab-button {
      position: relative;
      padding: 7px 12px 6px;
      border-radius: 999px;
      border: none;
      font-size: 12px;
      cursor: pointer;
      background: #f1f4ff;
      color: #3949ab;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.16s ease-out;
    }

    .tab-button::before {
      content: attr(data-case-id);
      font-size: 10px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #e3e9ff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #1a237e;
      font-weight: 600;
    }

    .tab-button:hover {
      background: #e1e7ff;
      transform: translateY(-1px);
    }

    .tab-button.active {
      background: linear-gradient(135deg, #0052d4, #4286f4);
      color: #fff;
      box-shadow: 0 4px 12px rgba(0,82,212,0.35);
    }

    .tab-button.active::before {
      background: rgba(255,255,255,0.16);
      color: #fff;
    }

    .tab-content {
      display: none;
      padding-top: 4px;
    }

    .tab-content.active { display: block; }

    /* æ¡ˆä¾‹ä¸å°ç»„å¸ƒå±€ */
    .case-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.25fr) minmax(0, 1fr);
      gap: 14px;
      align-items: flex-start;
    }

    @media (max-width: 960px) {
      .case-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .case-column {
      background: #f7f8ff;
      border-radius: 14px;
      padding: 10px 10px 12px;
      border: 1px solid #dfe4ff;
      position: relative;
    }

    .case-column::before {
      content: "CASE";
      position: absolute;
      top: 8px;
      right: 10px;
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      color: #3949ab;
      background: rgba(255,255,255,0.8);
      border: 1px solid rgba(57,73,171,0.15);
    }

    .case-text-title {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .case-tag {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e3f2fd;
      color: #1565c0;
    }

    .case-text pre {
      margin: 0;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-wrap;
      background: #ffffff;
      border-radius: 8px;
      padding: 8px 9px;
      border: 1px solid #e0e7ff;
      max-height: 420px;
      overflow-y: auto;
    }

    .group-section {
      background: #ffffff;
      border-radius: 14px;
      padding: 10px 11px 12px;
      border: 1px solid #e3e3e3;
    }

    .group-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .group-section-header-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-badge {
      padding: 2px 7px;
      border-radius: 999px;
      background: #f3e5f5;
      color: #6a1b9a;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .group-section-header h3 { font-size: 15px; }

    .group-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 4px;
    }

    .group-toolbar .hint {
      font-size: 12px;
      color: var(--text-light);
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.16s ease-out;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ffb300, #ff8f00);
      color: #3e2723;
      box-shadow: 0 4px 10px rgba(255,143,0,0.3);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(255,143,0,0.4);
    }

    .btn-outline {
      background: #ffffff;
      color: #1e88e5;
      border-radius: 999px;
      border: 1px solid #bbdefb;
    }

    .btn-outline:hover { background: #e3f2fd; }
    .btn .plus { font-size: 15px; line-height: 1; }

    /* å°ç»„å¡ç‰‡ */
    .groups-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .group-panel {
      border-radius: 12px;
      border: 1px solid var(--border);
      background: linear-gradient(145deg, #ffffff, #fafafa);
      padding: 9px 9px 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.03);
    }

    .group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 6px;
    }

    .group-header-left {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .group-badge {
      padding: 2px 7px;
      border-radius: 999px;
      background: #e8eaf6;
      color: #1a237e;
      font-size: 11px;
      font-weight: 600;
    }

    .group-header strong { font-size: 14px; }

    .score-badge {
      padding: 2px 9px;
      border-radius: 999px;
      font-size: 11px;
      background: #fff8e1;
      color: #f57f17;
      border: 1px solid #ffe082;
      display: inline-flex;
      align-items: center;
      gap: 3px;
    }

    .score-badge span.chip-icon {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff 0, #ffb300 30%, #f57f17 70%);
      box-shadow: 0 0 0 1px rgba(245,127,23,0.5);
    }

    .group-header-right {
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 4px;
      flex-wrap: wrap;
    }

    .group-header-right label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .group-header-right input.group-name {
      padding: 4px 7px;
      border-radius: 999px;
      border: 1px solid #d1d1d1;
      font-size: 12px;
      min-width: 120px;
    }

    /* æ–‡æœ¬åŸŸ */
    .group-fields { margin-bottom: 4px; }

    .field-row { margin-bottom: 5px; }

    .field-row label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      font-size: 12px;
      margin-bottom: 2px;
    }

    .field-tag {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #fff;
    }

    .tag-say { background: #1e88e5; }
    .tag-think { background: #7b1fa2; }
    .tag-do { background: #00897b; }
    .tag-feel { background: #ef6c00; }

    .group-fields textarea {
      width: 100%;
      border-radius: 8px;
      border: 1px solid #d7d7d7;
      padding: 6px;
      font-size: 12px;
      resize: vertical;
      min-height: 50px;
      transition: border-color 0.16s, box-shadow 0.16s;
    }

    .group-fields textarea:focus {
      border-color: #1e88e5;
      box-shadow: 0 0 0 1px rgba(30,136,229,0.25);
      outline: none;
    }

    .judge-btn {
      margin-top: 2px;
      margin-bottom: 4px;
      font-size: 12px;
    }

    /* ç»“æœæ˜¾ç¤º */
    .group-result {
      border-top: 1px dashed #d0d0d0;
      margin-top: 6px;
      padding-top: 6px;
    }

    .group-result h4 {
      font-size: 13px;
      margin-bottom: 3px;
    }

    .scores {
      font-size: 12px;
      margin-bottom: 6px;
    }

    .score-line { margin: 2px 0; }

    .score-line strong { color: #1e88e5; }
    .score-line span.neg { color: var(--danger); }

    .overall-comment h4 {
      font-size: 12px;
      margin-bottom: 2px;
    }

    .overall-comment pre {
      margin: 0;
      white-space: pre-wrap;
      word-break: break-all;
      font-size: 12px;
      background: #fafafa;
      padding: 5px 6px;
      border-radius: 6px;
      border: 1px dashed #dfdfdf;
    }

    /* å››ç»´åº¦æ»‘è½¨ */
    .dim-meters {
      margin-top: 4px;
      padding: 4px 6px 6px;
      border-radius: 8px;
      border: 1px dashed #e0e0e0;
      background: #fcfcfc;
    }

    .dim-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 2px 0;
      font-size: 11px;
    }

    .dim-label {
      width: 82px;
      color: var(--text-light);
    }

    .dim-row input[type="range"] {
      flex: 1;
      accent-color: #1e88e5;
    }

    .dim-value {
      width: 48px;
      text-align: right;
      font-weight: 600;
      color: #1e88e5;
    }

    .dim-value.neg {
      color: var(--danger);
    }

    .meter {
      margin-top: 4px;
    }

    .meter-labels {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--text-light);
      margin-bottom: 2px;
      margin-top: 2px;
    }

    .trust-meter {
      width: 100%;
      accent-color: #1e88e5;
    }

    .trust-meter[disabled] {
      opacity: 0.9;
    }

    .trust-value {
      font-size: 11px;
      font-weight: 600;
      color: #1e88e5;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="top-bar-main">
      <div class="title-block">
        <div class="title-badge">
          <span class="dot"></span>
          <span>LEADERSHIP ARENA Â· å›¢é˜ŸPKèµ›</span>
        </div>
        <h1>æ–°ä¸–ä»£æƒ…å¢ƒé¢†å¯¼åŠ› Â· 9å¤§æ¡ˆä¾‹è¯æ®AIè£åˆ¤</h1>
        <div class="top-subtitle">
          æ¯ä¸ªå°ç»„æäº¤ã€è¯´ / æƒ³ / åš / æ„Ÿè§‰ã€‘è¯æ®å¡ï¼ŒAI è´Ÿè´£æ‰“ç­¹ç åˆ† & æ›´æ–°ä¿¡ä»»è´¦æˆ·ã€‚
        </div>
      </div>
      <div class="top-bar-right">
        <div class="top-tip">
          æœ¬å·¥å…·ä½¿ç”¨æ‰˜ç®¡åœ¨ Vercel çš„å®‰å…¨ä»£ç†è°ƒç”¨ <code>deepseek-chat</code> æ¨¡å‹ï¼ŒAPI Key å­˜æ”¾åœ¨æœåŠ¡ç«¯ç¯å¢ƒå˜é‡ä¸­ï¼Œå­¦å‘˜æ— éœ€åœ¨ç½‘é¡µä¸­è¾“å…¥ Keyã€‚
        </div>
      </div>
    </div>
  </div>

  <div class="main-shell">
    <div class="scoreboard" id="globalScoreboard">
      <div class="scoreboard-header">
        <div class="scoreboard-title-block">
          <span class="scoreboard-badge">SCOREBOARD</span>
          <h2>å°ç»„ç­¹ç æ€»è§ˆ</h2>
        </div>
        <div class="scoreboard-active-case" id="scoreboardActiveCase">å½“å‰æ¡ˆä¾‹ï¼šâ€”</div>
      </div>
      <div class="scoreboard-body" id="globalScoreboardBody">
        <div class="scoreboard-empty">å½“å‰æ¡ˆä¾‹è¿˜æ²¡æœ‰è¯„åˆ¤è®°å½•ï¼Œè¯·å…ˆåœ¨ä¸‹æ–¹å®Œæˆå°ç»„è¯„åˆ¤ã€‚</div>
      </div>
    </div>

    <div class="tabs" id="tabs"></div>
    <div id="tabContents"></div>
  </div>

  <script>
    // å‰ç«¯è°ƒç”¨çš„ Vercel ä»£ç†åœ°å€
    const DEEPSEEK_PROXY_URL = "https://leadership-sandbox.vercel.app/api/deepseek-chat";

    // ====== 9ä¸ªæ¡ˆä¾‹åŸæ–‡ + æ•™ç»ƒæç¤º + ç¤ºä¾‹ ======
    const caseData = {
      /* â€”â€” è¿™é‡Œä¿ç•™ä½ åŸæ¥ç²˜è´´çš„ caseData å†…å®¹ï¼ˆç•¥ï¼‰ â€”â€” */
      /* ä¸ºèŠ‚çœç¯‡å¹…ï¼Œæˆ‘æ²¡æœ‰æ”¹åŠ¨ caseDataï¼Œæœ¬è´¨ä¸Šè·Ÿä½ å‘ä¸Šæ¥çš„å®Œå…¨ä¸€è‡´ */
      /* ç›´æ¥ç”¨ä½ åŸæ¥çš„ caseData å®šä¹‰å³å¯ */
    };

    // ====== åˆå§‹åŒ–æ ‡ç­¾é¡µå’Œå°ç»„ ======
    function initTabsAndGroups() {
      const tabsContainer = document.getElementById("tabs");
      const contentsContainer = document.getElementById("tabContents");
      const caseIds = Object.keys(caseData);

      caseIds.forEach((id, index) => {
        const info = caseData[id];

        const tabBtn = document.createElement("button");
        tabBtn.className = "tab-button" + (index === 0 ? " active" : "");
        tabBtn.dataset.caseId = id;
        tabBtn.textContent = info.title;
        tabBtn.setAttribute("data-case-id", id);
        tabBtn.addEventListener("click", () => activateTab(id));
        tabsContainer.appendChild(tabBtn);

        const content = document.createElement("div");
        content.className = "tab-content" + (index === 0 ? " active" : "");
        content.id = "case-content-" + id;
        content.innerHTML = `
          <div class="case-layout">
            <div class="case-column">
              <div class="case-text-title">
                <span class="case-tag">æ¡ˆä¾‹åŸæ–‡</span>
                <h2>${info.title}</h2>
              </div>
              <div class="case-text">
                <pre>${info.originalText}</pre>
              </div>
            </div>
            <div class="group-section">
              <div class="group-section-header">
                <div class="group-section-header-left">
                  <span class="section-badge">TEAM PLAY</span>
                  <h3>å°ç»„è¯æ®å¡ Â· ç­¹ç å¯¹å†³</h3>
                </div>
              </div>
              <div class="group-toolbar">
                <button type="button" class="btn btn-primary" onclick="addGroup('${id}')">
                  <span class="plus">ï¼‹</span>æ–°å¢å°ç»„
                </button>
                <span class="hint">æ¯ä¸ªå°ç»„å¡«å†™ã€è¯´ / æƒ³ / åš / æ„Ÿè§‰ã€‘ï¼Œå†ç‚¹å‡»æœ¬ç»„çš„â€œè¯„åˆ¤å¹¶è®¡ç®—ç­¹ç â€ã€‚åˆ‡æ¢æ ‡ç­¾é¡µä¸ä¼šä¸¢å¤±ç»“æœã€‚</span>
              </div>
              <div class="groups-container" id="groups-container-${id}"></div>
            </div>
          </div>
        `;
        contentsContainer.appendChild(content);

        addGroup(id);
      });

      if (caseIds.length > 0) {
        updateGlobalScoreboard(caseIds[0]);
      }
    }

    function activateTab(caseId) {
      document.querySelectorAll(".tab-button").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.caseId === caseId);
      });
      document.querySelectorAll(".tab-content").forEach(div => {
        div.classList.toggle("active", div.id === "case-content-" + caseId);
      });
      updateGlobalScoreboard(caseId);
    }

    // ====== æ–°å¢å°ç»„ ======
    function addGroup(caseId) {
      const container = document.getElementById("groups-container-" + caseId);
      const groupIndex = container.children.length + 1;
      const groupDomId = `case${caseId}-group${groupIndex}`;

      const wrapper = document.createElement("div");
      wrapper.className = "group-panel";
      wrapper.dataset.caseId = caseId;
      wrapper.dataset.groupIndex = groupIndex;
      wrapper.id = groupDomId;

      wrapper.innerHTML = `
        <div class="group-header">
          <div class="group-header-left">
            <span class="group-badge">ç»„ ${groupIndex}</span>
            <strong>å°ç»„${groupIndex}</strong>
            <span class="score-badge" title="æœ¬æ¡ˆå‡€ç­¹ç ">
              <span class="chip-icon"></span>
              <span class="score-text">å‡€ç­¹ç ï¼š0</span>
            </span>
          </div>
          <div class="group-header-right">
            <label>å°ç»„åç§°ï¼š
              <input type="text" class="group-name" value="å°ç»„${groupIndex}"
                     oninput="updateGlobalScoreboard('${caseId}')" />
            </label>
          </div>
        </div>
        <div class="group-fields">
          <div class="field-row">
            <label><span class="field-tag tag-say">è¯´</span>ä½ ä¼šæ€ä¹ˆè¯´ï¼Ÿ</label>
            <textarea class="field-say" placeholder="å…³é”®2-3å¥è¯ï¼Œå¯ä»¥ç”¨SBI/STARç»“æ„æè¿°äº‹å®â€”è¡Œä¸ºâ€”å½±å“ï¼Œè®©å¯¹æ–¹æ—¢è¢«å°Šé‡åˆè¢«æé†’ã€‚"></textarea>
          </div>
          <div class="field-row">
            <label><span class="field-tag tag-think">æƒ³</span>ä½ çš„æ„å›¾å’ŒåŸåˆ™æ˜¯ä»€ä¹ˆï¼Ÿ</label>
            <textarea class="field-think" placeholder="æƒ³ä¿æŠ¤ä»€ä¹ˆã€æƒ³è¾¾æˆä»€ä¹ˆï¼Ÿå¦‚ä½•åœ¨ä»»åŠ¡è¾¾æˆã€å…³ç³»ç»´æŠ¤ã€ä¸ªäººæˆé•¿ä¹‹é—´å–å¾—å¹³è¡¡ï¼Ÿ"></textarea>
          </div>
          <div class="field-row">
            <label><span class="field-tag tag-do">åš</span>ä½ ä¼šé‡‡å–å“ªäº›å…·ä½“è¡ŒåŠ¨ï¼Ÿ</label>
            <textarea class="field-do" placeholder="å†™å‡º1~3æ¡å¯æ‰§è¡ŒåŠ¨ä½œï¼Œå¹¶å°½é‡å†™æ¸…å·¥å…·å’Œæ–¹æ³•ï¼Œæ¯”å¦‚PESOSã€GROWTã€4Rã€æˆæƒäº”æ­¥æ³•ã€YCYAç­‰ã€‚"></textarea>
          </div>
          <div class="field-row">
            <label><span class="field-tag tag-feel">æ„Ÿ</span>ä½ å¸Œæœ›å¯¹æ–¹/å›¢é˜Ÿæœ‰ä»€ä¹ˆæ„Ÿå—ï¼Ÿ</label>
            <textarea class="field-feel" placeholder="å¸Œæœ›ä»–ä»¬æ„Ÿåˆ°è¢«å°Šé‡ã€è¢«æ”¯æŒã€è¢«æŒ‘æˆ˜ï¼Ÿä¹Ÿé¢„åˆ¤å¯èƒ½å‡ºç°çš„è´Ÿé¢æƒ…ç»ªï¼Œå¹¶å†™å‡ºä½ çš„é¢„é˜²æˆ–ä¿®å¤æ–¹å¼ã€‚"></textarea>
          </div>
        </div>

        <button type="button" class="btn btn-outline judge-btn" onclick="evaluateGroup('${caseId}', '${groupDomId}')">
          ğŸ¯ è¯„åˆ¤å¹¶è®¡ç®—ç­¹ç 
        </button>

        <div class="group-result" style="display:none;">
          <h4>è¯„åˆ¤ç»“æœ Â· ç­¹ç æˆ˜æŠ¥</h4>
          <div class="scores"></div>
          <div class="overall-comment"></div>

          <div class="dim-meters">
            <div class="dim-row">
              <span class="dim-label">ä»»åŠ¡è¾¾æˆ</span>
              <input type="range" min="0" max="100" value="0" class="dim-meter-task" disabled />
              <span class="dim-value dim-task-value">0</span>
            </div>
            <div class="dim-row">
              <span class="dim-label">å›¢é˜Ÿèƒ½é‡</span>
              <input type="range" min="0" max="100" value="0" class="dim-meter-energy" disabled />
              <span class="dim-value dim-energy-value">0</span>
            </div>
            <div class="dim-row">
              <span class="dim-label">ä»·å€¼å®ç°</span>
              <input type="range" min="0" max="100" value="0" class="dim-meter-value" disabled />
              <span class="dim-value dim-value-value">0</span>
            </div>
            <div class="dim-row">
              <span class="dim-label">é£é™©ï¼ˆæ‰£å‡ï¼‰</span>
              <input type="range" min="-100" max="0" value="0" class="dim-meter-risk" disabled />
              <span class="dim-value dim-risk-value">0</span>
            </div>
          </div>

          <div class="meter">
            <div class="meter-labels">
              <span>å–æ¬¾åŠ¨ä½œï¼ˆ-100ï¼‰</span>
              <span>èµ·ç‚¹ï¼ˆ0ï¼‰</span>
              <span>å­˜æ¬¾åŠ¨ä½œï¼ˆ+300ï¼‰</span>
            </div>
            <input type="range" min="-100" max="300" value="0" class="trust-meter" disabled />
            <div class="meter-labels">
              <span class="trust-value">å½“å‰å‡€ç­¹ç ï¼š0</span>
            </div>
          </div>
        </div>
      `;

      container.appendChild(wrapper);
    }

    // å®‰å…¨è§£æ JSONï¼ˆé˜²æ­¢åŒ…è£¹ ```json```ï¼‰
    function safeParseJSON(str) {
      try { return JSON.parse(str); }
      catch (e) {
        try {
          const cleaned = str.trim()
            .replace(/^```json/i, "")
            .replace(/^```/, "")
            .replace(/```$/, "");
          return JSON.parse(cleaned);
        } catch (e2) { throw e2; }
      }
    }

    // ====== æ›´æ–°é¡¶éƒ¨ Scoreboard ======
    function updateGlobalScoreboard(caseId) {
      const activeTitle = caseData[caseId]?.title || ("æƒ…å¢ƒ" + caseId);
      const activeCaseLabel = document.getElementById("scoreboardActiveCase");
      const body = document.getElementById("globalScoreboardBody");
      activeCaseLabel.textContent = "å½“å‰æ¡ˆä¾‹ï¼š" + activeTitle;

      const groups = document.querySelectorAll(`.group-panel[data-case-id="${caseId}"]`);
      let hasScore = false;
      body.innerHTML = "";

      groups.forEach(group => {
        if (!group.dataset.evaluated) return;
        hasScore = true;

        const idx = group.dataset.groupIndex;
        const nameInput = group.querySelector(".group-name");
        const name = (nameInput?.value.trim()) || ("å°ç»„" + idx);

        const taskScore   = Number(group.dataset.taskScore || 0);
        const energyScore = Number(group.dataset.energyScore || 0);
        const valueScore  = Number(group.dataset.valueScore || 0);
        const penalty     = Number(group.dataset.penalty || 0);
        const net         = Number(group.dataset.net || 0);

        const row = document.createElement("div");
        row.className = "scoreboard-row";
        row.innerHTML = `
          <div class="scoreboard-row-header">
            <span class="scoreboard-group-name">æƒ…å¢ƒ${caseId} Â· ${name}</span>
            <span class="scoreboard-group-net">å‡€ç­¹ç ï¼š${net}</span>
          </div>
          <div class="scoreboard-meters">
            <div class="scoreboard-meter">
              <span class="meter-label">ä»»åŠ¡è¾¾æˆ</span>
              <input type="range" min="0" max="100" value="${taskScore}" disabled />
              <span class="meter-value">+${taskScore}</span>
            </div>
            <div class="scoreboard-meter">
              <span class="meter-label">å›¢é˜Ÿèƒ½é‡</span>
              <input type="range" min="0" max="100" value="${energyScore}" disabled />
              <span class="meter-value">+${energyScore}</span>
            </div>
            <div class="scoreboard-meter">
              <span class="meter-label">ä»·å€¼å®ç°</span>
              <input type="range" min="0" max="100" value="${valueScore}" disabled />
              <span class="meter-value">+${valueScore}</span>
            </div>
            <div class="scoreboard-meter">
              <span class="meter-label">é£é™©æ‰£å‡</span>
              <input type="range" min="-100" max="0" value="${penalty}" disabled />
              <span class="meter-value ${penalty < 0 ? "neg" : ""}">${penalty}</span>
            </div>
          </div>
        `;
        body.appendChild(row);
      });

      if (!hasScore) {
        body.innerHTML = `<div class="scoreboard-empty">å½“å‰æ¡ˆä¾‹è¿˜æ²¡æœ‰è¯„åˆ¤è®°å½•ï¼Œè¯·å…ˆåœ¨ä¸‹æ–¹å®Œæˆå°ç»„è¯„åˆ¤ã€‚</div>`;
      }
    }

    // ====== è°ƒç”¨ Vercel ä»£ç†è¯„åˆ¤å•ä¸ªå°ç»„ ======
    async function evaluateGroup(caseId, groupDomId) {
      const groupDiv = document.getElementById(groupDomId);
      const say = groupDiv.querySelector(".field-say").value.trim();
      const think = groupDiv.querySelector(".field-think").value.trim();
      const doText = groupDiv.querySelector(".field-do").value.trim();
      const feel = groupDiv.querySelector(".field-feel").value.trim();
      const groupNameInput = groupDiv.querySelector(".group-name").value.trim();
      const groupName = groupNameInput || ("å°ç»„" + groupDiv.dataset.groupIndex);

      if (!say && !think && !doText && !feel) {
        alert("è¯·è‡³å°‘åœ¨ã€è¯´ / æƒ³ / åš / æ„Ÿè§‰ã€‘ä¸­å¡«å†™ä¸€éƒ¨åˆ†å†…å®¹ï¼Œå†ç‚¹å‡»è¯„åˆ¤ã€‚");
        return;
      }

      const info = caseData[caseId];

      const systemPrompt = `
ä½ æ˜¯ä¸€åä¼ä¸šåŸ¹è®­è¯¾ç¨‹ä¸­çš„â€œè¯„åˆ¤æ•™ç»ƒâ€ï¼Œæ­£åœ¨ç»™å¤šä¸ªå°ç»„çš„è¯æ®å¡æ‰“åˆ†ã€‚ä½ éœ€è¦ç»“åˆã€Šæ–°ä¸–ä»£æƒ…å¢ƒé¢†å¯¼åŠ›ã€‹æ²™ç›˜ä¸­çš„å…·ä½“æ¡ˆä¾‹æƒ…å¢ƒæ¥åˆ¤æ–­å­¦å‘˜çš„æ–¹æ¡ˆè´¨é‡ã€‚

è¯„åˆ¤æ—¶è¯·å›´ç»•å››ä¸ªç»´åº¦ï¼š
1ï¼‰ä»»åŠ¡è¾¾æˆï¼ˆwork_impactï¼‰ï¼šæ˜¯å¦æœ‰åŠ©äºå½“å‰æ¡ˆä¾‹ä¸­çš„ä»»åŠ¡/ä¸šåŠ¡ç»“æœè¾¾æˆï¼Ÿï¼ˆä¾‹å¦‚å®¢æˆ·æ»¡æ„ã€é¡¹ç›®æˆåŠŸã€é—®é¢˜è§£å†³ã€æ±‡æŠ¥æ¸…æ™°ç­‰ï¼‰
2ï¼‰å›¢é˜Ÿèƒ½é‡ï¼ˆteam_energyï¼‰ï¼šæ˜¯å¦æå‡å›¢é˜Ÿæƒ…ç»ªã€å£«æ°”ã€åä½œæ°›å›´ï¼Ÿæ˜¯å¦æœ‰åŠ©äºå»ºç«‹ä¼™ä¼´å…³ç³»å’Œäº’ä¿¡ï¼Ÿ
3ï¼‰ä»·å€¼å®ç°ï¼ˆpeople_valueï¼‰ï¼šæ˜¯å¦å¸®åŠ©å½“äº‹äººæˆ–å›¢é˜Ÿè·å¾—æˆé•¿ã€èƒ½åŠ›æå‡æˆ–è§‚å¿µå‡çº§ï¼Ÿæ˜¯å¦ä½“ç°è¾…å¯¼ã€æ•™ç»ƒã€æˆæƒã€èµ‹èƒ½ç­‰å‘å±•è§†è§’ï¼Ÿ
4ï¼‰é£é™©ï¼ˆnegative_riskï¼‰ï¼šè¯æ®ä¸­çš„åšæ³•æ˜¯å¦ä¼šå¸¦æ¥æ˜æ˜¾æ¶ˆæé£é™©ï¼ˆå®¢æˆ·æµå¤±ã€ä¿¡ä»»å—æŸã€åˆè§„/å®‰å…¨é—®é¢˜ã€é‡å¤§æ‰§è¡Œé£é™©ç­‰ï¼‰ï¼Ÿ

è¯„åˆ†æ–¹å¼ï¼ˆå…¨éƒ¨ä»¥ç­¹ç å½¢å¼è®¡åˆ†ï¼‰ï¼š
- å¯¹å‰ä¸‰ä¸ªæ­£å‘ç»´åº¦ï¼Œåˆ†åˆ«ç»™å‡º 0~100 ä¹‹é—´ã€ä¸”ä¸º10çš„å€æ•°çš„åˆ†æ•°ï¼Œä»£è¡¨å¯ä»¥å‘å‡ºçš„æ­£å‘ç­¹ç æ•°é‡ã€‚ä¸‰é¡¹åˆ†æ•°ä¹‹å’Œæœ€å¤š 300ã€‚
- å¯¹é£é™©ç»´åº¦ï¼Œç»™å‡º 0 æˆ–è´Ÿæ•°ï¼ˆ0 åˆ° -100 ä¹‹é—´ï¼Œä¸º10çš„å€æ•°ï¼‰ï¼Œä»£è¡¨åº”æ‰£é™¤çš„ç­¹ç æ•°é‡ã€‚æ²¡æœ‰æ˜æ˜¾é£é™©æ—¶ä¸º 0ã€‚
- åªæ ¹æ®æœ¬æ¡ˆä¾‹æƒ…å¢ƒå’Œå­¦å‘˜è¯æ®å†…å®¹ä½œåˆ¤æ–­ã€‚

è¾“å‡ºæ ¼å¼ï¼š
ä½ å¿…é¡»åªè¾“å‡ºä¸€ä¸ª JSON å¯¹è±¡ï¼Œä¸è¦åŒ…å«ä»»ä½•é¢å¤–æ–‡å­—ã€‚ç»“æ„å¦‚ä¸‹ï¼š
{
  "task":   { "score": 0,   "comment": "..." },
  "energy": { "score": 0,   "comment": "..." },
  "value":  { "score": 0,   "comment": "..." },
  "risk":   { "penalty": 0, "comment": "..." },
  "overall_comment": "..."
}
è¦æ±‚ï¼š
- æ‰€æœ‰åˆ†å€¼ä¸ºæ•´æ•°ä¸”æ˜¯10çš„å€æ•°ï¼›
- task/energy/value ä¸‰é¡¹çš„ score åŠ æ€»ä¸è¶…è¿‡ 300ï¼›
- risk.penalty ä¸º 0 æˆ–è´Ÿæ•°ï¼Œä¸‹é™ä¸º -100ï¼›
- è¯„è¯­ä½¿ç”¨ç§¯æã€è‚¯å®šã€å…·ä½“çš„è¯­æ°”ï¼Œæ—¢è¦è¡¨æ‰¬äº®ç‚¹ï¼Œä¹Ÿè¦æå‡ºæ¸…æ™°å¯æ‰§è¡Œçš„æ”¹è¿›å»ºè®®ï¼›
- ä¸è¦ä½¿ç”¨â€œå¤§çº¦â€â€œå¯èƒ½â€â€œå·®ä¸å¤šâ€â€œçœ‹èµ·æ¥â€â€œä¹Ÿè®¸â€â€œä¼¼ä¹â€â€œåº”è¯¥å¯ä»¥â€ç­‰æ¨¡ç³Šæˆ–çŠ¹è±«çš„è¯è¯­ï¼Œè®©å­¦å‘˜ä¸€çœ‹å°±çŸ¥é“å“ªé‡Œåšå¾—å¥½ã€ä¸‹ä¸€æ­¥æ€ä¹ˆä¼˜åŒ–ã€‚

æœ¬æ¡ˆä¾‹çš„æ•™ç»ƒæç¤ºï¼ˆä»…ä¾›ä½ ç†è§£åˆ¤åˆ†é‡ç‚¹ï¼Œä¸è¦åœ¨è¾“å‡ºä¸­é‡å¤ï¼‰ï¼š
${info.coachHint}

ä¸ºäº†ä¿è¯ä¸åŒå°ç»„è¯„åˆ†æ ‡å‡†ä¸€è‡´ï¼Œè¯·å‚è€ƒä¸‹é¢ä¸‰ä¸ªä¸åŒè´¨é‡çš„è¯æ®å¡ç¤ºä¾‹ï¼ˆåŒæ ·ä¸è¦åœ¨è¾“å‡ºä¸­å¼•ç”¨æˆ–å¤è¿°è¿™äº›æ–‡å­—ï¼Œä»…ç”¨äºæ ¡å‡†ä½ çš„æ‰“åˆ†å°ºåº¦ï¼‰ï¼š
ã€é«˜è´¨é‡è¯æ®ç¤ºä¾‹ã€‘${info.bestExample}
ã€å°šå¯è¯æ®ç¤ºä¾‹ã€‘${info.okExample}
ã€ä½è´¨é‡è¯æ®ç¤ºä¾‹ã€‘${info.worstExample}
      `;

      const userPrompt = `
ã€æ¡ˆä¾‹åŸæ–‡ã€‘
${info.originalText}

ã€å°ç»„åç§°ã€‘
${groupName}

ã€å°ç»„è¯æ®å¡ã€‘
è¯´ï¼š${say || "ï¼ˆæœªå¡«å†™ï¼‰"}
æƒ³ï¼š${think || "ï¼ˆæœªå¡«å†™ï¼‰"}
åšï¼š${doText || "ï¼ˆæœªå¡«å†™ï¼‰"}
æ„Ÿè§‰ï¼š${feel || "ï¼ˆæœªå¡«å†™ï¼‰"}

è¯·æ ¹æ®ä¸Šè¿°è¯æ®å¡å†…å®¹ï¼Œä»ä»»åŠ¡è¾¾æˆ / å›¢é˜Ÿèƒ½é‡ / ä»·å€¼å®ç° / é£é™©å››ä¸ªç»´åº¦æ‰“ç­¹ç åˆ†ï¼Œå¹¶ç»™å‡ºç®€è¦ç‚¹è¯„ã€‚è¯·ä¸¥æ ¼æŒ‰ç…§ç³»ç»Ÿæç¤ºä¸­çš„ JSON ç»“æ„è¿”å›ã€‚`;

      try {
        const response = await fetch(DEEPSEEK_PROXY_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "deepseek-chat",
            messages: [
              { role: "system", content: systemPrompt },
              { role: "user", content: userPrompt }
            ]
          })
        });

        if (!response.ok) {
          const errorText = await response.text();
          alert("è°ƒç”¨ DeepSeek ä»£ç†å¤±è´¥ï¼š\n" + errorText);
          return;
        }

        const data = await response.json();
        const content = data.choices[0].message.content;
        let result;
        try {
          result = safeParseJSON(content);
        } catch (e) {
          alert("æ¨¡å‹è¿”å›å†…å®¹æ— æ³•è§£æä¸º JSONï¼Œè¯·æ£€æŸ¥æç¤ºè¯æˆ–æ—¥å¿—ã€‚\nåŸå§‹å†…å®¹ï¼š\n" + content);
          return;
        }

        const taskScore   = Number(result.task?.score   || 0);
        const energyScore = Number(result.energy?.score || 0);
        const valueScore  = Number(result.value?.score  || 0);
        const penalty     = Number(result.risk?.penalty || 0);

        const positiveTotal = taskScore + energyScore + valueScore;
        const penaltyAbs    = Math.abs(Math.min(penalty, 0));
        let net             = positiveTotal + penalty;

        if (net > 300) net = 300;
        if (net < -100) net = -100;

        const resultBox = groupDiv.querySelector(".group-result");
        const scoresDiv = groupDiv.querySelector(".scores");
        const overallDiv = groupDiv.querySelector(".overall-comment");
        const meter = groupDiv.querySelector(".trust-meter");
        const trustValueSpan = groupDiv.querySelector(".trust-value");
        const scoreBadgeText = groupDiv.querySelector(".score-badge .score-text");

        resultBox.style.display = "block";
        scoresDiv.innerHTML = `
          <div class="score-line">ä»»åŠ¡è¾¾æˆï¼ˆå·¥ä½œé¢ï¼‰ï¼š<strong>+${taskScore}</strong> ç­¹ç  â€”â€” ${result.task?.comment || ""}</div>
          <div class="score-line">å›¢é˜Ÿèƒ½é‡ï¼ˆå›¢é˜Ÿé¢ï¼‰ï¼š<strong>+${energyScore}</strong> ç­¹ç  â€”â€” ${result.energy?.comment || ""}</div>
          <div class="score-line">ä»·å€¼å®ç°ï¼ˆäººå‘˜é¢ï¼‰ï¼š<strong>+${valueScore}</strong> ç­¹ç  â€”â€” ${result.value?.comment || ""}</div>
          <div class="score-line">é£é™©ï¼ˆæ¶ˆæé£é™©ï¼‰ï¼š<strong class="neg">${penalty}</strong> ç­¹ç  â€”â€” ${result.risk?.comment || ""}</div>
          <div class="score-line"><strong>æ­£å‘ç­¹ç åˆè®¡ï¼š</strong>${positiveTotal}ï¼›<strong>æƒ©ç½šç­¹ç åˆè®¡ï¼š</strong>${penaltyAbs}ï¼›<strong>å‡€ç­¹ç ï¼š</strong>${net}</div>
        `;
        overallDiv.innerHTML = `<h4>ç»¼åˆç‚¹è¯„ï¼š</h4><pre>${result.overall_comment || ""}</pre>`;

        meter.value = net;
        trustValueSpan.textContent = "å½“å‰å‡€ç­¹ç ï¼š" + net;
        scoreBadgeText.textContent = "å‡€ç­¹ç ï¼š" + net;

        const dimTaskMeter   = groupDiv.querySelector(".dim-meter-task");
        const dimEnergyMeter = groupDiv.querySelector(".dim-meter-energy");
        const dimValueMeter  = groupDiv.querySelector(".dim-meter-value");
        const dimRiskMeter   = groupDiv.querySelector(".dim-meter-risk");

        const dimTaskValue   = groupDiv.querySelector(".dim-task-value");
        const dimEnergyValue = groupDiv.querySelector(".dim-energy-value");
        const dimValueValue  = groupDiv.querySelector(".dim-value-value");
        const dimRiskValue   = groupDiv.querySelector(".dim-risk-value");

        if (dimTaskMeter)   { dimTaskMeter.value = taskScore;   dimTaskValue.textContent = taskScore; }
        if (dimEnergyMeter) { dimEnergyMeter.value = energyScore; dimEnergyValue.textContent = energyScore; }
        if (dimValueMeter)  { dimValueMeter.value = valueScore;  dimValueValue.textContent = valueScore; }
        if (dimRiskMeter)   {
          dimRiskMeter.value = penalty;
          dimRiskValue.textContent = penalty;
          if (penalty < 0) dimRiskValue.classList.add("neg");
          else dimRiskValue.classList.remove("neg");
        }

        groupDiv.dataset.taskScore = taskScore;
        groupDiv.dataset.energyScore = energyScore;
        groupDiv.dataset.valueScore = valueScore;
        groupDiv.dataset.penalty = penalty;
        groupDiv.dataset.net = net;
        groupDiv.dataset.evaluated = "1";

        updateGlobalScoreboard(caseId);

      } catch (err) {
        alert("è°ƒç”¨æˆ–å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼š" + err.message);
      }
    }

    window.addGroup = addGroup;
    window.evaluateGroup = evaluateGroup;
    window.updateGlobalScoreboard = updateGlobalScoreboard;

    document.addEventListener("DOMContentLoaded", () => {
      initTabsAndGroups();
    });
  </script>
</body>
</html>
